See Flowchart for high-level overview of math/code.